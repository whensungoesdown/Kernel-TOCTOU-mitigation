%! TEX root = 'main.tex'
\section{Abstract}
%The key novelty of our work is that it uses SMAP facilities already supported by mainstream Intel CPU to achieve negligible runtime overhead when monitoring kernel to user space accessing activities. Also we use a hypervisor layer to establish a process based fine-grain control of system wide hardware feature, in this case, SMAP, in order to reduce unnecessary performance overhead that waste on protection needless scenarios.


Time-of-check-to-time-of-use (TOCTOU) attacks (also known as race condition) have gained popularity in recent years. In this paper, we address a branch of this issue that exists in the operating system kernel. When the operating system kernel uses the same user-mode variable more than one time during a system call, the user variable can be maliciously overwritten between two references. Thus, the kernel encounters data inconsistencies, and it could lead to more serious vulnerabilities such as kernel buffer overflow. We have detailed the causes of this vulnerability in real-world cases. By utilizing an existing hardware feather of Intel CPU named Supervisor Mode Access Prevention (SMAP), we present the first run-time approach that mitigation kernel space TOCTOU vulnerability. When kernel code reads/writes a user variable, an exception will raise due to SMAP and the page that contains this variable will be protected. We set the user page's page table attribute so that it becomes a kernel page for the rest of the current system call. Therefore, no user code can access that user variable. We also solved the page sharing issues with a novel solution. Because the exception is raised by hardware and it only happens when there is actually an unmanaged kernel-access-user-data case, which is not good kernel practice, our mitigation's performance overhead is modest. We evaluate it with non-trivial applications. On average, it's below 5\%.
