%! TEX root = 'main.tex'
\section{Abstract}
%The key novelty of our work is that it uses SMAP facilities already supported by mainstream Intel CPU to achieve negligible runtime overhead when monitoring kernel to user space accessing activities. Also we use a hypervisor layer to establish a process based fine-grain control of system wide hardware feature, in this case, SMAP, in order to reduce unnecessary performance overhead that waste on protection needless scenarios.

Time-of-check-to-time-of-use (TOCTOU) attacks (also known as race condition) have gained popularity in recent years. In this paper, we address a branch of this issue that exists in the operating system kernel. When the operating system kernel uses the same user-mode variable two or more times during one system call, the user variable can be maliciously tampered between two references. Thus the kernel encounters data inconsistencies, and it could lead to more serious vulnerabilities such as kernel buffer overflow. We have detailed the causes of this vulnerability in real-world cases. By utilizing an existing hardware feather on Intel CPU called Supervisor Mode Access Prevention (SMAP),  we present the first run-time approach that mitigation kernel space TOCTOU vulnerability. When kernel code reads/writes a user variable, the page that contains this variable will be protected by changing it to a kernel page during the life-span of the current system call. More challenged issue such as user threads share writing the same memory page as the kernel is also discussed and novel solutions are given. We also evaluate it with non-trivial applications and the performance overhead is modest (below 5\%).  

